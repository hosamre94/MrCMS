@using System.Linq
@using MrCMS.Entities.Documents.Layout
@using MrCMS.Website
@model MrCMS.Web.Admin.Models.UpdateLayoutModel
@inject IWidgetLoader WidgetLoader
@{
    ViewBag.Title = Model.Name;
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    var layoutAreas = ViewData["layout-areas"] as List<LayoutArea> ?? new List<LayoutArea>();
}
<form asp-controller="Layout" asp-action="Edit" id="edit-document" method="post">

    <div class="mb-3">
        <admin-header>
            <row>
                <admin-header-title title="@Model.Name"/>
                <admin-header-actions>
                    @if (Html.CanDeleteLayout(Model.Id))
                    {
                        <a id="@Model.Id" href="@Url.Action("Delete", "Layout", new { id = Model.Id })" class="btn btn-danger" data-toggle="fb-modal">
                            <i class="icon ti ti-trash"></i>@await Html.Resource("Delete")
                        </a>
                    }
                    <a class="btn btn-secondary" href="@Url.ActionLink("Set", "Layout", new { id = Model.Id })" data-toggle="fb-modal">
                        <i class="icon ti ti-arrows-move"></i>@await Html.Resource("Move")
                    </a>
                    <button class="btn btn-primary" id="save-edit">
                        <i class="icon ti ti-device-floppy"></i>@await Html.Resource("Save")
                    </button>
                </admin-header-actions>
            </row>
        </admin-header>
        <card>
            <card-body>
                @if (TempData["saved"] != null)
                {
                    <div class="alert alert-success">
                        <a class="btn-close" data-bs-dismiss="alert" aria-label="close"></a>
                        @TempData["saved"]
                    </div>
                }

                @Html.HiddenFor(x => x.Id)
                <div class="row">
                    <div class="col-lg-12">

                        <div class="form-group mb-3">
                            <label asp-for="Name" class="form-label"></label>
                            <input type="text" asp-for="Name" class="form-control"/>
                            <span asp-validation-for="Name"></span>
                        </div>

                        <div class="form-group mb-3">
                            <label asp-for="UrlSegment" class="form-label"></label>
                            <input type="text" asp-for="UrlSegment" class="form-control"/>
                            <span asp-validation-for="UrlSegment"></span>
                        </div>

                        <div class="form-group">
                            <div class="form-check">
                                <input asp-for="Hidden" type="checkbox" class="form-check-input"/>
                                <label asp-for="Hidden" class="form-check-label"></label>
                            </div>
                            <span asp-validation-for="Hidden"></span>
                        </div>

                    </div>
                </div>
            </card-body>
        </card>
    </div>


    <div>
        <admin-header>
            <row>
                <admin-header-title title="@await Html.Resource("admin-layout-areas", "Layout Areas")"/>
                <admin-header-actions>
                    <a href="@Url.Action("Add", "LayoutArea", new { id = Model.Id })" class="btn btn-primary" data-toggle="fb-modal">
                        <i class="icon ti ti-apps"></i>@await Html.Resource("admin-layout-area-add", "Add layout area")
                    </a>
                </admin-header-actions>
            </row>
        </admin-header>
        <card>
            <card-body>
                @{
                    if (layoutAreas.Any())
                    {
                        <table class="table table-condensed table-borderd table-striped">
                            <thead>
                            <tr>
                                <th>@await Html.Resource("Areas")</th>
                                <th>@await Html.Resource("Action")</th>
                            </tr>
                            </thead>
                            <tbody>
                            @foreach (LayoutArea area in layoutAreas.OrderBy(x => x.AreaName).ToList())
                            {
                                var widgets = await WidgetLoader.GetWidgets(area);
                                <tr>
                                    <td>
                                        @area.AreaName (@widgets.Count)
                                    </td>
                                    <td>
                                        <a href="@Url.Action("Edit", "LayoutArea", new { id = area.Id })" class="btn btn-secondary btn-sm">
                                            @await Html.Resource("Edit")
                                        </a>
                                        <a href="@Url.Action("Delete", "LayoutArea", new { id = area.Id })" class="btn btn-sm btn-danger" data-toggle="fb-modal">
                                            @await Html.Resource("Delete")
                                        </a>
                                    </td>
                                </tr>
                            }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        @await Html.Resource("admin-layout-add-info", "Click Add layout area to add the first area to this layout")
                    }
                }
            </card-body>
        </card>
    </div>

</form>