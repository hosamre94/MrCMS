@using MrCMS.Entities.Widget
@using MrCMS.Web.Admin.Infrastructure.Helpers
@model MrCMS.Web.Admin.Models.UpdateWidgetModel
@{
    var widget = ViewData["widget"] as Widget;
    ViewBag.Title = "Edit | " + widget.WidgetTypeFormatted;
    var cacheExpiryOptions = ViewData["cache-expiry-options"] as List<SelectListItem> ?? new List<SelectListItem>();
}
@using (Html.BeginForm("Edit", "Widget", new { }, FormMethod.Post, null, new { id = "edit-widget" }))
{
    <admin-header>
        <row>
            <admin-header-title title="@(!string.IsNullOrWhiteSpace(Model.Name) ? Model.Name : widget.WidgetTypeFormatted)"/>
            <admin-header-actions>
                <a href="@Url.Action("Edit", "LayoutArea", new { Id = widget.LayoutArea.Id })" class="btn btn-dark">
                    <i class="icon ti ti-arrow-back"></i>
                    @await Html.Resource("admin-back", "Back")
                </a>
                <button class="btn btn-primary" id="add-widget">
                    <i class="icon ti ti-device-floppy"></i>
                    @await Html.Resource("admin-save", "Save")
                </button>
            </admin-header-actions>
        </row>
    </admin-header>
    <card>
        <card-body>
            @Html.HiddenFor(model => model.Id)
            @Html.Hidden("ReturnUrl", ViewData["return-url"])

            <div class="form-floating mb-3">
                @Html.TextBoxFor(model => model.Name, new { @class = "form-control" })
                @Html.LabelFor(model => model.Name)
            </div>

            @await Html.RenderUpdateCustomAdminProperties(widget)

            @if (widget.IsTypeCacheable())
            {
                <hr/>
                <h4>@await Html.Resource("Advanced")</h4>
                <hr class="small-margin"/>
                <div class="form-group">
                    @Html.InlineCheckboxFor(model => model.Cache)
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.CacheLength)
                    @Html.TextBoxFor(model => model.CacheLength, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CacheLength)
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.CacheExpiryType)
                    @Html.DropDownListFor(model => model.CacheExpiryType, cacheExpiryOptions, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.CacheExpiryType)
                </div>
            }
        </card-body>
        <div class="card-footer">
            <div class="row">
                <div class="col-md-4">
                    <table class="small m-0">
                        <tr>
                            <td class="fw-bold" width="110">
                                <i class="me-1 ti ti-tag"></i>
                                @await Html.Resource("Admin Widget Type", "WidgetType"):
                            </td>
                            <td>
                                @widget.GetType().Name
                            </td>
                        </tr>
                        <tr>
                            <td class="fw-bold">
                                <i class="me-1 ti ti-layout-dashboard"></i>
                                @await Html.Resource("Admin Layout Area", "Layout Area"):
                            </td>
                            <td>
                                @widget.LayoutArea.Unproxy().AreaName
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="col-md-4">
                    <table class="small">
                        <tr>
                            <td class="fw-bold" width="110">
                                <i class="me-1 ti ti-user"></i>
                                @await Html.Resource("Created By"):
                            </td>
                            <td>
                                @widget.CreatedBy.Name
                            </td>
                        </tr>
                        <tr>
                            <td class="fw-bold">
                                <i class="me-1 ti ti-edit"></i>
                                @await Html.Resource("Updated On"):
                            </td>
                            <td>
                                @widget.UpdatedOn.ToString("dd-MM-yyyy hh:mm tt")
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </card>
}